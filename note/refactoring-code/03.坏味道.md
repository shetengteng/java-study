# 代码的坏味道



## 神秘命名

- 好的命名可清晰的表达功能和用法



## 重复代码

- 坏处：修改代码需要找到重复代码进行修改

- 改进
  - 需要采用提炼函数，提炼重复的代码
  - 代码相似，尝试移动语句重组代码顺序，提炼相同代码
  - 不同子类代码相同，尝试将提炼相同的代码上移到父类中



## 过长函数

- 推荐使用小函数
- 功能单一，可复用性强，加之命名规范，可省去注释
- 当感觉需要用注释说明什么的时候，尝试抽取成独立函数
  - 使用用途命名，而非实现方式
  - 找到函数中适合集中的部分，进行提炼
  - 如果有大量临时文件，尝试使用查询方式取代临时变量，提升可读性
    - 尽可能少的临时变量
    - 使用引入参数对象（包裹参数）
    - 保持上下文对象完整（传参传递整个对象）

- 场景
  - 找到注释多的地方，进行提炼
  - 条件表达式，循环语句适合提炼



## 过长参数列表

- 以查询取代参数
  - 有性能上的损失，但在一般场合下几乎微不足道
    - 如果严重影响性能，可例外单独处理

- 保持对象的完整性
  - 多个参数来源于一个参数，那么就传递这个参数（反正是引用传递）
- 多个参数多次同时出现，考虑使用一个参数对象包裹这些参数传递

- 如果一个参数作为分支判断的条件，那么去除该参数，将分支内的实现单独抽取出来作为函数
- 如果多个函数使用同样的几个参数，考虑封装成类，共同参数称为类的字段



## 全局数据

- 对全局数据的修改要做封装和限制修改的作用域，减少被误改的风险
- 全局数据不能太多



## 可变数据

- 可变的数据可能会导致难以发现的bug
- 函数式编程
  - 建立在数据不改变的概念基础上
  - 更新一个数据结构，就返回一个新的数据副本，旧的数据保持不变
- 使用封装变量保证数据更新通过少量函数执行
  - 容易被监控
- 以查询取代派生变量
- 设计API时，将查询函数和修改函数分离